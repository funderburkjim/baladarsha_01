<!DOCTYPE html>
<!-- // (setq js-indent-level 1)  # for Emacs -->

<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Sanskrit Flashcards</title>
  <style>
    body { font-family: sans-serif; text-align: center; padding: 2em; }
    .card { border: 1px solid #ccc; padding: 2em; margin: 1em auto; width: 300px; cursor: pointer; display: none; }
    .gender { font-size: 0.9em; color: #555; margin-top: 0.5em; }
    select, input[type="file"], button { margin: 0.5em; }

    /* Modal styles */
    #modalOverlay {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.6); display: none; justify-content: center; align-items: center;
    }
    #modalContent {
      background: white; padding: 1em; border-radius: 8px; max-width: 600px; width: 90%;
    }
    #previewTable { width: 100%; border-collapse: collapse; margin-top: 1em; }
    #previewTable th, #previewTable td { border: 1px solid #ccc; padding: 0.5em; }
  </style>
</head>
<body>
  <h1>Sanskrit Flashcards</h1>

  <!-- Dynamic dropdown -->
  <label for="vocabSelector">Choose hosted vocab:</label>
  <select id="vocabSelector" onchange="loadHostedVocab()">
    <option value="">-- Select --</option>
  </select>

  <!-- File upload -->
  <br>
  <label for="fileInput">Or upload your own:</label>
  <input type="file" id="fileInput" accept=".json,.tsv">

  <!-- Buttons -->
  <div>
    <button onclick="prevCard()">Prev</button>
    <button onclick="nextCard()">Next</button>
    <button onclick="showInfo()">Info</button>
  </div>

  <!-- Flashcard -->
  <div class="card" onclick="flipCard()">
    <div id="cardText">Choose a vocab set to begin</div>
    <div class="gender" id="genderText"></div>
  </div>

  <!-- Modal Preview -->
  <div id="modalOverlay">
    <div id="modalContent">
      <h2>Preview Vocabulary</h2>
      <table id="previewTable">
        <thead><tr><th>Sanskrit</th><th>English</th><th>Gender</th></tr></thead>
        <tbody id="previewBody"></tbody>
      </table>
      <button onclick="closeModal()">Start Flashcards</button>
    </div>
  </div>

  <script>
    let vocab = [];
    let current = 0;
    let flipped = false;
    let history = [];

    // GitHub repo info
    const repoOwner = "your-username"; // ← replace with your GitHub username
    const repoName = "your-repo";      // ← replace with your repo name
    const vocabPath = "vocab";

    function parseTSV(text) {
      const lines = text.trim().split('\n');
      return lines.slice(1).map(line => {
        const [sanskrit, english, gender] = line.split('\t');
        return { sanskrit, english, gender };
      });
    }

    async function loadHostedVocab() {
      const url = document.getElementById("vocabSelector").value;
      if (!url) return;

      try {
        const response = await fetch(url);
        const text = await response.text();
        vocab = url.endsWith('.tsv') ? parseTSV(text) : JSON.parse(text);
        vocab = vocab.sort(() => Math.random() - 0.5);
        current = 0;
        flipped = false;
        history = [];
        updatePreview();
        showModal();
      } catch (err) {
        document.getElementById("cardText").textContent = "Error loading hosted vocab.";
        console.error("Fetch error:", err);
      }
    }

    document.getElementById('fileInput').addEventListener('change', function(event) {
      const file = event.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = function(e) {
        try {
          const text = e.target.result;
          vocab = file.name.endsWith('.tsv') ? parseTSV(text) : JSON.parse(text);
          vocab = vocab.sort(() => Math.random() - 0.5);
          current = 0;
          flipped = false;
          history = [];
          updatePreview();
          showModal();
        } catch (err) {
          document.getElementById("cardText").textContent = "Invalid file format.";
          console.error("Parse error:", err);
        }
      };
      reader.readAsText(file);
    });

    function showCard() {
      if (vocab.length === 0) return;
      const word = vocab[current];
      document.getElementById("cardText").textContent = flipped ? word.english : word.sanskrit;
      document.getElementById("genderText").textContent = flipped ? "" : `Gender: ${word.gender}`;
      document.querySelector(".card").style.display = "block";
    }

    function flipCard() {
      flipped = !flipped;
      showCard();
    }

    function nextCard() {
      history.push(current);
      current = (current + 1) % vocab.length;
      flipped = false;
      showCard();
    }

    function prevCard() {
      if (history.length === 0) return;
      current = history.pop();
      flipped = false;
      showCard();
    }

    function updatePreview() {
      const tbody = document.getElementById("previewBody");
      tbody.innerHTML = "";
      vocab.forEach(entry => {
        const row = document.createElement("tr");
        row.innerHTML = `<td>${entry.sanskrit}</td><td>${entry.english}</td><td>${entry.gender}</td>`;
        tbody.appendChild(row);
      });
    }

    function showModal() {
      document.getElementById("modalOverlay").style.display = "flex";
      document.querySelector(".card").style.display = "none";
    }

    function closeModal() {
      document.getElementById("modalOverlay").style.display = "none";
      showCard();
    }

    function showInfo() {
      alert("Click the flashcard to flip and reveal the answer.\nUse 'Next' and 'Prev' to navigate.\nPreview shows the full vocab before starting.");
    }

// Load vocablist.txt and populate dropdown
async function populateFileList() {
 try {
  console.log('enter populateFileList')
  const response = await fetch("vocablist.txt");
  console.log('response=',response)
    const text = await response.text();
    const lines = text.trim().split("\n");
    const selector = document.getElementById("vocabSelector");

    lines.forEach(path => {
      const option = document.createElement("option");
      option.value = path;
      option.textContent = path.split("/").pop(); // Show just the filename
      selector.appendChild(option);
    });
  } catch (err) {
    console.error("Failed to load vocablist.txt:", err);
  }
}

populateFileList();

  </script>
</body>
</html>
